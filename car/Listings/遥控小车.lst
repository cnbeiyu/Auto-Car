C51 COMPILER V9.56.0.0   ________                                                          04/02/2019 23:47:05 PAGE 1   


C51 COMPILER V9.56.0.0, COMPILATION OF MODULE ________
OBJECT MODULE PLACED IN .\Objects\遥控小车.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE 遥控小车.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\
                    -遥控小车.lst) TABS(2) OBJECT(.\Objects\遥控小车.obj)

line level    source

   1          #include<reg52.h>
   2          #include<intrins.h>
   3          #define uint unsigned int
   4          #define uchar unsigned char
   5          sbit IN1=P1^1;  //置1是左边两个轮子向后转，置0停止                
   6          sbit IN2=P1^2;  //置1是左边两个轮子向前转，置0停止  
   7          sbit IN3=P1^3;  //置1是右边两个轮子向前转，置0停止  
   8          sbit IN4=P1^5;  //置1是右边两个轮子向后转，置0停止 
   9          sbit Trig=P3^2; //触发测距（发送）
  10          sbit Echo=P3^3; //回响信息（接收）
  11          uchar i,num,temp,temp2;
  12          uchar flag=0;
  13          ////////////////////延时函数（ms）//////////////////////
  14          void delay(uint z)
  15          {
  16   1        uint x,y;
  17   1        for(x=z;x>0;x--)
  18   1          for(y=110;y>0;y--);
  19   1      }
  20          /////////////////// 延时函数（us）/////////////////////
  21          void delayus(uint xus)
  22          {
  23   1        uint i;
  24   1        for(i=0;i<xus;i++)
  25   1        {
  26   2          _nop_();  //12MHZ晶振延时1us
  27   2        }
  28   1      }
  29          /////////////////////超声波初始化///////////////////
  30          //void C_init()
  31          //{
  32          //  Trig=0; //初始化为0
  33          //  Echo=0; //初始化为0
  34          //  Trig=1; //拉高Trig    
  35          //  delayus(10);  //延时10us
  36          //}
  37          ////////////////////超声波接收/////////////////////
  38          //void C_output()
  39          //{
  40          //  
  41          //}
  42          ////////////////////串口初始化///////////////////
  43          void open()//打开串口通信
  44          {
  45   1        SCON=0x50;//串口设置为工作方式2
  46   1        TMOD=0x21;//设置定时器1为工作方式2
  47   1      
  48   1        TH1=0xfd;//T1定时器装初值，波特率为9600
  49   1        TL1=0xfd;//T1定时器装初值，波特率为9600
  50   1        TR1=1;//打开定时器1
  51   1        //TR0=1;
  52   1        //EA=1;
  53   1        //ET0=1;
  54   1      }
C51 COMPILER V9.56.0.0   ________                                                          04/02/2019 23:47:05 PAGE 2   

  55          
  56          ////////////////////小车移动/////////////////////
  57          void go_on()//控制垃圾桶前进
  58          {
  59   1        for(i=0;i<5;i++) //占空比，控制速度为半速
  60   1        {
  61   2          IN1=0;IN2=1;
  62   2          IN3=1;IN4=0;
  63   2          delay(10);
  64   2          IN1=0;IN2=0;
  65   2          IN3=0;IN4=0;
  66   2          delay(10);
  67   2        }
  68   1      }
  69          void hou_on()//控制垃圾桶后退
  70          {
  71   1        for(i=0;i<5;i++)//占空比，控制速度为半速
  72   1        {
  73   2          IN1=1;IN2=0;
  74   2          IN3=0;IN4=1;
  75   2          delay(10);
  76   2          IN1=0;IN2=0;
  77   2          IN3=0;IN4=0;
  78   2          delay(10);
  79   2        } 
  80   1      }
  81          void youzhuan()//控制垃圾桶右转
  82          {
  83   1        for(i=0;i<5;i++)//占空比，控制速度为半速
  84   1        {
  85   2          IN1=0;IN2=0;
  86   2          IN3=1;IN4=0;
  87   2          delay(10);
  88   2          IN1=0;IN2=0;
  89   2          IN3=0;IN4=0;
  90   2          delay(10);
  91   2        }
  92   1      }
  93          void zuozhuan()//控制垃圾桶左转
  94          {
  95   1        for(i=0;i<5;i++)//占空比，控制速度为半速
  96   1        {
  97   2          IN1=0;IN2=1;
  98   2          IN3=0;IN4=0;
  99   2          delay(10);
 100   2          IN1=0;IN2=0;
 101   2          IN3=0;IN4=0;
 102   2          delay(10);
 103   2        }
 104   1      }
 105          void stop()////控制垃圾桶停止
 106          {
 107   1        IN1=0;IN2=0;
 108   1        IN3=0;IN4=0;
 109   1      }
 110          
 111          //////////////////////蓝牙接收信号//////////////
 112          void get() //接收数据
 113          {
 114   1        if(RI==1)//判断是否接收完成
 115   1        {
 116   2          RI=0; //接收完成，清零
C51 COMPILER V9.56.0.0   ________                                                          04/02/2019 23:47:05 PAGE 3   

 117   2          flag=1;
 118   2      //    switch(SBUF)//根据信号选择操作
 119   2      //    {
 120   2      //      case 0x00:n=1;break;   //前进
 121   2      //      case 0x01:n;break;   //后退
 122   2      //      case 0x02:zuozhuan();break;//左转
 123   2      //      case 0x03:youzhuan();break;//右转
 124   2      //      case 0x04:stop();break;    //停止
 125   2      //    } 
 126   2            
 127   2        } 
 128   1        if(flag==1)
 129   1        {
 130   2      
 131   2            EA=1;ET0=1;TR0=1;
 132   2            switch(SBUF)//根据信号选择操作
 133   2            {
 134   3              case 0x00:go_on();break;   //前进
 135   3              case 0x01:hou_on();break;  //后退
 136   3              case 0x02:zuozhuan();break;//左转
 137   3              case 0x03:youzhuan();break;//右转
 138   3              case 0x04:stop();break;    //停止
 139   3              //case 0x05:youzhuan();delay(1200);stop();break;
 140   3            } 
 141   2        }
 142   1      }
 143          
 144          ///////////////////////主函数///////////////////
 145          void main()
 146          {
 147   1        stop(); //小车初始状态：停止
 148   1        SBUF=0x04;
 149   1        open(); //打开串口通信  
 150   1        TH0=(65536-45872)/256;
 151   1        TL0=(65536-45872)%256;
 152   1        while(1)  
 153   1          get();//获取数据，小车移动
 154   1      }
 155          ////////////////////////////////////////////////
 156          void T0_time() interrupt 1
 157          {
 158   1        TH0=(65536-45872)/256;
 159   1        TL0=(65536-45872)%256;
 160   1        num++;
 161   1        if(num==20)
 162   1        {
 163   2          flag=0;
 164   2          num=0;
 165   2        }
 166   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    285    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      5    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
